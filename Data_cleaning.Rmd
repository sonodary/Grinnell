---
title: "Project2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readxl)
library(dplyr)
#Read the file for health data
health_data = "~/Desktop/CS/Grinnell/County Health Rankings Data - v2.xlsx"
excel_sheets(path = health_data)
Ranked_measured_Data <- read_excel(path = health_data, sheet = "Ranked Measure Data", skip = 1)

#Create the table with our chosen explanatory variables
data_keep = Ranked_measured_Data[, c(1, 2, 3, 24, 28, 32, 37, 56, 60, 64, 66, 70, 72, 85, 111, 115, 119, 153, 166, 175, 178, 204, 217, 237)] 

#The same thing for additional measured data
Additional_measured_data <- read_excel(path = health_data, sheet = "Additional Measure Data", skip = 1)
data_keep2 = Additional_measured_data[, c(2, 3, 4, 23, 42, 61, 91, 93, 95, 132, 136, 158, 198, 246, 249)] 

#Combine the two data
totalData <- merge(data_keep, data_keep2,by=c("State","County"))

#In order to create population density, read the table for land area
library(readr)
land_data = read_csv("~/Desktop/CS/Grinnell/dexter_2129905758_extract.csv", skip = 1)
#Keep the total area and FIPS
land = land_data[, c(6, 18)]

#Merge into the totalData and create population density and WorkersDriveAloneLong
totalData = merge(totalData, land, by.x = "FIPS", by.y = "County FIPS", all.x = TRUE)

#Create population density
totalData$`Total area (square miles)` = as.numeric(totalData$`Total area (square miles)`)
#Divide the population by area and create a new population density variable
totalData$populationDensity = totalData$Population / totalData$`Total area (square miles)`

#View(totalData)

#Create a number of mental health providers per 100,000 people
library(tidyverse)
totalData = totalData %>%
    separate(`Mental Health Provider Ratio`, c("MentalHealthProvidorratioLeft", "MentalHealthProvidorratioRight"), sep=":")
totalData$MentalHealthProvidorratioLeft = as.numeric(unlist(totalData$MentalHealthProvidorratioLeft))
totalData$MentalHealthProvidorratioRight = as.numeric(unlist(totalData$MentalHealthProvidorratioRight))
Right = totalData$MentalHealthProvidorratioRight
Left = totalData$MentalHealthProvidorratioLeft

#Convert NA into 0 and 1 temporary to to division
Right[is.na(Right)] = 0
Left[is.na(Left)] = 1
totalData$MentalHealthProviderRate = (Right / Left) * 100000
totalData$MentalHealthProviderRate
totalData$MentalHealthProviderRate[near(totalData$MentalHealthProviderRate, 0)] =  NA

#Create a number of Primary Care Phsycians per 100,000 people
totalData = totalData %>%
    separate(`Primary Care Physicians Ratio`, c("PrimaryCarePhysiciansRatioLeft", "PrimaryCarePhysiciansRatioRight"), sep=":")
totalData$PrimaryCarePhysiciansRatioLeft = as.numeric(unlist(totalData$PrimaryCarePhysiciansRatioLeft))
totalData$PrimaryCarePhysiciansRatioRight = as.numeric(unlist(totalData$PrimaryCarePhysiciansRatioRight))
Right = totalData$PrimaryCarePhysiciansRatioRight
Left = totalData$PrimaryCarePhysiciansRatioLeft
Right[is.na(Right)] = 0
Left[is.na(Left)] = 1
totalData$PrimaryCarePhysiciansRatioRate = (Right / Left) * 100000
totalData$PrimaryCarePhysiciansRatioRate[near(totalData$PrimaryCarePhysiciansRatioRate, 0)] =  NA

#Create a number of Dentist per 100,000 people
totalData = totalData %>%
    separate(`Dentist Ratio`, c("DentistRatioLeft", "DentistRatioRight"), sep=":")
totalData$DentistRatioLeft = as.numeric(unlist(totalData$DentistRatioLeft))
totalData$DentistRatioRight = as.numeric(unlist(totalData$DentistRatioRight))
Right = totalData$DentistRatioRight
Left = totalData$DentistRatioLeft
Right[is.na(Right)] = 0
Left[is.na(Left)] = 1
totalData$DentistRatioRate = (Right / Left) * 100000
totalData$DentistRatioRate[near(totalData$DentistRatioRate, 0)] =  NA
totalData$DentistRatioRate

#Drop the newly created unnecessary columns 
finalData = select(totalData, -15, -16, -17, -18, -19, -20)

#Change the name of variables
colnames(finalData) [36] = "Population density"
colnames(finalData) [37] = "Mental Health Providor Rate"
colnames(finalData) [38] = "Primary Care Physicians Rate"
colnames(finalData) [39] = "Dentist Rate"

write.csv(finalData, "~/Desktop/CS/CSC324_individual/CSC324_project_data.csv")
```

